<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="style.css">
    <title>JEE Organic Live Hub</title>
    <script>
      window.MathJax = {
        tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], packages: {'[+]': ['mhchem']} },
        loader: { load: ['[tex]/mhchem'] }
      };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="reactions.js"></script> 
</head>
<body>

<div class="container">
    <h1 style="text-align: center; color: #2ECC71;">üß™ Master Organic - Aarav</h1>
    
    <div style="display: flex; justify-content: flex-end; gap: 10px; margin-bottom: 20px;">
        <button class="theme-switch-inline" onclick="startStudyMode()">üìñ Study Mode</button>
        <button class="theme-switch-inline" onclick="toggleTheme()" id="themeBtn">üåô Dark Mode</button>
    </div>

    <div class="filter-row">
        <button class="filter-btn active" onclick="filterByCat('All', event)">All</button>
        <button class="filter-btn" onclick="filterByCat('Naming', event)">Naming</button>
        <button class="filter-btn" onclick="filterByCat('Reduction', event)">Reduction</button>
        <button class="filter-btn" onclick="filterByCat('Oxidation', event)">Oxidation</button>
        <button class="filter-btn" onclick="filterByCat('Tests', event)">Tests</button>
    </div>
    
    <input type="text" id="mainSearch" class="search-bar" placeholder="Search reagents...">
    <div id="feed"></div>
</div>

<div id="studyOverlay" style="display:none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); flex-direction: column; align-items: center; justify-content: center; z-index: 5000;">
    <button onclick="exitStudyMode()" style="position:absolute; top:20px; right:20px; background:white; border:none; border-radius:50%; width:40px; height:40px; font-weight:bold; cursor:pointer; z-index: 6000;">‚úï</button>
    <div id="flashcard-container"></div>
    <p style="color:white; margin-top:20px;">Tap to Flip Back & Forth ‚Ä¢ Swipe up for Next</p>
</div>

<script>
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);

    const firebaseConfig = {
        apiKey: "AIzaSyDIW-SJkO5j4PwN1SDjMxGD_aQdoDHD6CU",
        authDomain: "organic-chem-b2ff8.firebaseapp.com",
        projectId: "organic-chem-b2ff8",
        databaseURL: "https://organic-chem-b2ff8-default-rtdb.firebaseio.com",
        storageBucket: "organic-chem-b2ff8.firebasestorage.app",
        messagingSenderId: "799844686854",
        appId: "1:799844686854:web:b9014316afd5ba5233f787"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let allReactions = [];
    let studyData = [];
    let studyIndex = 0;
    let touchStartY = 0;

    db.ref('custom_reactions').on('value', (snap) => {
        const data = snap.val();
        const custom = [];
        for(let id in data) custom.push({...data[id], firebaseId: id});
        allReactions = (typeof reactionDatabase !== 'undefined') ? [...reactionDatabase, ...custom] : custom;
        render(allReactions);
    });

    function startStudyMode() {
        if (allReactions.length === 0) return alert("No reactions found!");
        studyData = [...allReactions].sort(() => Math.random() - 0.5);
        studyIndex = 0;
        document.getElementById('studyOverlay').style.display = 'flex';
        renderFlashcard();
    }

    function exitStudyMode() { document.getElementById('studyOverlay').style.display = 'none'; }

    function renderFlashcard() {
        const r = studyData[studyIndex];
        const container = document.getElementById('flashcard-container');
        
        container.innerHTML = `
            <div class="flashcard" id="currentFlashcard" onclick="this.classList.toggle('flipped')">
                <div class="flashcard-inner">
                    <div class="card-front">
                        <small>REAGENT</small>
                        <h1 style="font-size:2em; margin: 10px 0;">${r.reagent}</h1>
                        <p style="font-style: italic; opacity: 0.9;">${r.name || ''}</p>
                    </div>
                    <div class="card-back" onclick="event.stopPropagation(); this.parentElement.parentElement.classList.toggle('flipped')">
                        <h2 style="color:#2ecc71; margin-bottom: 5px;">${r.function}</h2>
                        
                        <div style="background:#f0f0f0; padding:10px; border-radius:8px; margin:5px 0; width: 100%; font-family: monospace;">
                            ${r.example || ''}
                        </div>

                        ${r.warning ? `<div class="warning-box"><strong>‚ö†Ô∏è Warning:</strong> ${r.warning}</div>` : ''}

                        <div style="text-align: left; width: 100%; margin-top: 10px; font-size: 0.85em;">
                            <strong>Hacks:</strong> ${r.notes || 'None'}
                        </div>

                        <button onclick="event.stopPropagation(); nextCard()" style="background:#2ecc71; color:white; border:none; padding:12px 25px; border-radius:25px; margin-top: auto; cursor:pointer; font-weight: bold;">Next Reaction ‚Üí</button>
                    </div>
                </div>
            </div>
        `;

        const card = document.getElementById('currentFlashcard');
        card.addEventListener('touchstart', e => touchStartY = e.touches[0].clientY);
        card.addEventListener('touchend', e => {
            if (touchStartY - e.changedTouches[0].clientY > 70) nextCard();
        });
        if (window.MathJax) window.MathJax.typeset();
    }

    function nextCard() {
        studyIndex = (studyIndex + 1) % studyData.length;
        renderFlashcard();
    }

    function toggleTheme() {
        const html = document.documentElement;
        const target = html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
        html.setAttribute('data-theme', target);
        localStorage.setItem('theme', target);
        document.getElementById('themeBtn').innerText = target === 'light' ? 'üåô Dark Mode' : '‚òÄÔ∏è Light Mode';
    }

    function render(data) {
        const feed = document.getElementById('feed');
        feed.innerHTML = data.map(r => `<div class="card"><h3>${r.reagent}</h3><p>${r.function}</p></div>`).join('');
    }
</script>
</body>
</html>
